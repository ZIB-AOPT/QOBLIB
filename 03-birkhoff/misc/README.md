# Miscellaneous

This directory contains utility scripts and data files for working with Birkhoff polytope instances and solutions.

## Scripts

### sol2json.py

Converts solution files from the solver format to JSON format containing the Birkhoff decomposition and matrix representation.

**Usage:**
```bash
python sol2json.py <solution_dir> <output_dir>
```

- `solution_dir`: Directory containing `.sol` files, must be of format `path/to/bhD-<n>` (dense) or `path/to/bhS-<n>` (sparse)
- `output_dir`: Directory where the resulting JSON file will be created

**Output format:**
- Each instance has an `id` field in format `B{n}_{density}_{num}` (e.g., `B3_9_5` for dense, `B3_3_5` for sparse)
- Contains `scaled_doubly_stochastic_matrix`, `weights`, `permutations`, `optimal` flag, matrix dimension `n`, and number of permutations `k`

**Requirements:** Python 3.7+

### json2mdtable.py

Generates Markdown tables from JSON solution files for documentation.

**Usage:**
```bash
python json2mdtable.py <outfile>
```

- `outfile`: Path where the resulting Markdown document will be written

**Note:** This script was used to create [solutions/README.md](../solutions/README.md).

### parse_matrices.py

Extracts matrices from JSON files and converts them to ZIMPL-compatible format.

**Usage:**
```bash
python parse_matrices.py <json_file> <matrix_dimension> <output_directory>
```

- `json_file`: JSON file containing the instances
- `matrix_dimension`: Integer specifying the dimension ($n$) of the matrices
- `output_directory`: Directory where output files will be written

### qbench_generate_dsm.jl

Julia script to generate random sparse and dense doubly stochastic matrices for testing.

**Usage:**
```bash
julia qbench_generate_dsm.jl <n> <dense|sparse>
```

- `n`: Matrix size
- `dense|sparse`: Type of matrix to generate

**Example:**
```bash
julia qbench_generate_dsm.jl 3 sparse
```

### get_zimpl_permutations.sh

Generates permutation data files needed by ZIMPL for modeling.

**Usage:**
```bash
./get_zimpl_permutations.sh [<START> <END>]
```

- `START`: First matrix size (default: 3)
- `END`: Last matrix size (default: 6)

## Data Files

### zimpl_p{n}.dat

Permutation data files for ZIMPL (where `n` is the matrix dimension). These files contain all permutations for size n, with each permutation on a separate line.

**Files included:**
- `zimpl_p03.dat` - Permutations for $n=3$
- `zimpl_p04.dat` - Permutations for $n=4$
- `zimpl_p05.dat` - Permutations for $n=5$
- `zimpl_p06.dat` - Permutations for $n=6$

**Note:** Do not delete these files as the ZIMPL formulation depends on the specific enumeration order.

### permutation.zpl

ZIMPL model file for permutation generation.

## Reading JSON Solution Files

### In Julia:
```julia
using JSON3

data = JSON3.read("file_name.json")
D = data[id].scaled_doubly_stochastic_matrix
D = reshape(D, n, n)
```

### In Python:
```python
import json
import numpy as np 

with open("file_name.json") as f:
    data = json.load(f)
    
D = data[id]['scaled_doubly_stochastic_matrix']
D = np.array(D)
D = np.reshape(D, (n, n))
```

## Permutation Matrix Mapping

We associate a permutation $\pi = (\pi_1, \pi_2, \ldots, \pi_n)$ with a permutation matrix $P = (p_{i,j}) ∈ \{0,1\}^{n \times n}$ in **column-based** manner:

For column index $j = 1, 2, \ldots, n$:

$$p_{ij} = 1 \Leftrightarrow i = \pi_j$$

This mapping is bijective.

**Example for $n=3$:**
$$
    \pi = (3,1,2) \quad\longleftrightarrow\quad
    P =
    \left(
    \begin{matrix}
        0 & 1 & 0 \\
        0 & 0 & 1 \\
        1 & 0 & 0 \\
    \end{matrix}
    \right)
$$

Each permutation π is associated with a unique integer $m \in \{1, \ldots, n!\}$ given by its line number in the corresponding `p<n>.dat` file.

**Note:** As of version 1.1.0 of QOBLIB, permutations are generated by ZIMPL directly. 
The mapping can still be extracted as described above but differs from earlier versions. 
